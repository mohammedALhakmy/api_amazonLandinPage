import{u as U,_ as H}from"./AuthenticatedLayout-OxjHRTln.js";import{s as Q,t as X,q as Y,C as Z,x as tt,W as et,l as ot,c as n,o as a,a as M,u as W,m as rt,w as st,b as e,g as r,f as nt,F as z,p as at}from"./app-h3y1KXtR.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const lt={class:"flex max-w-[1250px] mx-auto pt-4"},dt={class:"w-8/12"},it={class:"flex items-stretch border-b border-b-gray-300 w-[calc(100%-100px)] pb-4 pl-4 mb-6"},ut={class:"px-4 font-extrabold"},ct={class:"w-4/12 border border-gray-400 rounded-md py-4 px-2"},mt={id:"payment-form"},pt={class:"flex justify-between text-xl text-red-700 font-extrabold border-y border-y-gray-400 my-3 p-2"},ft={key:0},xt={id:"submit",class:"w-full bg-yellow-400 hover:bg-yellow-500 rounded-md text-sm font-extrabold p-2"},yt={key:0,id:"button-text"},bt={key:1,id:"button-text"},vt={class:"flex items-center py-1"},ht=["src"],gt={class:"ml-4"},_t={class:"text-lg font-extrabold"},St={class:"font-extrabold text-red-700"},$t={__name:"Checkout",props:{intent:Object,order:Object},setup(d){const A=U(),{cart:p}=Q(A),L=d,{intent:G}=X(L);let c=null,f=null,l=null,x=null,m=Y(!1);const y=Z({payment_intent:null});tt(()=>{c=Stripe("pk_test_51PjnhORtsizW0a8cfG5bJFfuSdXfTSNqIFQGueLNfoHOnjGlBnMBMzyhEmKtAN45J0MnUpITlL2N4TfCjDP6sfTh00zn5KpyTm"),f=c.elements();let o={base:{color:"#32325d",fontFamily:"Arial, sans-serif",fontSmoothing:"antialiased",fontSize:"16px","::placeholder":{color:"#32325d"}},invalid:{fontFamily:"Arial, sans-serif",color:"#fa755a",iconColor:"#fa755a"}};l=f.create("card",{style:o}),l.mount("#card-element"),l.on("loaderror",function(t){}),l.on("change",function(t){document.querySelector("button").disabled=t.empty,document.querySelector("#card-error").textContent=t.error?t.error.message:""}),x=document.getElementById("payment-form"),x.addEventListener("submit",function(t){t.preventDefault(),J(c,l,G.value.client_secret)}),setTimeout(()=>{et.post("/checkout",{total:K(),total_decimal:v,items:p.value})},10)});const J=(o,t,i)=>{b(!0),o.confirmCardPayment(i,{payment_method:{card:t}}).then(function(s){s.error?V(s.error.message):(console.log(s.paymentIntent.id),R(s.paymentIntent.id))})},R=o=>{y.payment_intent=o,y.put("/checkout")};let V=o=>{b(!1);var t=document.querySelector("#card-error");t.textContent=o,setTimeout(function(){t.textContent=""},4e3)},b=o=>{o?(document.querySelector("button").disabled=!0,m.value=!0):(document.querySelector("button").disabled=!1,m.value=!1)};const v=ot(()=>{let o=0;return p.value.forEach(t=>o+=t.price),o>0?o.toFixed(2):0}),K=()=>String(v.value).split(".").join("");return(o,t)=>(a(),n(z,null,[M(W(rt),{title:"CheckOut"}),M(H,null,{default:st(()=>{var i,s,h,g,_,S,w,C,k,$,N,T,j,q,F,O,B,E,I,P,D;return[t[4]||(t[4]=e("div",{class:"p-4 mt-2 max-w-[1250px] mx-auto text-3xl font-extrabold"},"Checkout",-1)),e("div",lt,[e("div",dt,[e("div",it,[t[0]||(t[0]=e("div",{class:"text-gray-900 font-extrabold text-xl mr-12"}," Shipping Address ",-1)),e("div",ut,[e("div",null,r((h=(s=(i=o.$page.props)==null?void 0:i.auth)==null?void 0:s.user)==null?void 0:h.first_name)+" - "+r((S=(_=(g=o.$page.props)==null?void 0:g.auth)==null?void 0:_.user)==null?void 0:S.last_name),1),e("div",null,r((k=(C=(w=o.$page.props)==null?void 0:w.auth)==null?void 0:C.address)==null?void 0:k.addr1),1),e("div",null,r((T=(N=($=o.$page.props)==null?void 0:$.auth)==null?void 0:N.address)==null?void 0:T.addr2),1),e("div",null,r((F=(q=(j=o.$page.props)==null?void 0:j.auth)==null?void 0:q.address)==null?void 0:F.city),1),e("div",null,r((E=(B=(O=o.$page.props)==null?void 0:O.auth)==null?void 0:B.address)==null?void 0:E.postcode),1),e("div",null,r((D=(P=(I=o.$page.props)==null?void 0:I.auth)==null?void 0:P.address)==null?void 0:D.country),1)])])]),e("div",ct,[e("form",mt,[t[2]||(t[2]=e("div",{class:"",id:"card-element"},null,-1)),e("div",pt,[t[1]||(t[1]=e("div",null,"Order total:",-1)),d.order?(a(),n("div",ft,"$"+r(d.order.total_decimal),1)):nt("",!0)]),e("button",xt,[W(m)?(a(),n("div",yt,"Processing...")):(a(),n("div",bt,"Place your order in USD"))]),t[3]||(t[3]=e("p",{id:"card-error",role:"alert",class:"text-red-700 text-center font-extrabold"},null,-1))])])]),t[5]||(t[5]=e("div",{class:"w-[1200px] mx-auto text-xl font-bold pb-2 underline"},"Items",-1)),(a(!0),n(z,null,at(JSON.parse(d.order.items),u=>(a(),n("div",{class:"w-[1200px] mx-auto",key:u},[e("div",vt,[e("img",{src:u.image,class:"rounded-md",width:"60",alt:""},null,8,ht),e("div",gt,[e("div",_t,r(u.title),1),e("div",St,r(u.price),1)])])]))),128))]}),_:1})],64))}};export{$t as default};
